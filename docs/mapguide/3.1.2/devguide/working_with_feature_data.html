<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Working With Feature Data &mdash; MapGuide Developer&#39;s Guide</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="MapGuide Developer&#39;s Guide" href="index.html" />
    <link rel="next" title="Modifying Maps and Layers" href="modifying_maps_and_layers.html" />
    <link rel="prev" title="Interacting With Layers" href="interacting_with_layers.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modifying_maps_and_layers.html" title="Modifying Maps and Layers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="interacting_with_layers.html" title="Interacting With Layers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MapGuide Developer&#39;s Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/mgos.gif" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Working With Feature Data</a><ul>
<li><a class="reference internal" href="#overview-of-features">Overview of Features</a></li>
<li><a class="reference internal" href="#querying-feature-data">Querying Feature Data</a><ul>
<li><a class="reference internal" href="#feature-readers">Feature Readers</a></li>
<li><a class="reference internal" href="#selecting-with-the-web-api">Selecting with the Web API</a><ul>
<li><a class="reference internal" href="#basic-filters">Basic Filters</a></li>
<li><a class="reference internal" href="#spatial-filters">Spatial Filters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-selection">Example: Selection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#active-selections">Active Selections</a><ul>
<li><a class="reference internal" href="#selecting-with-the-viewer">Selecting with the Viewer</a></li>
<li><a class="reference internal" href="#passing-viewer-information-to-the-web-server">Passing Viewer Information to the Web Server</a><ul>
<li><a class="reference internal" href="#additional-parameters-to-an-invoke-url-command">Additional Parameters to an Invoke URL Command</a></li>
<li><a class="reference internal" href="#passing-parameters-from-an-invoke-script-command">Passing Parameters from an Invoke Script Command</a></li>
<li><a class="reference internal" href="#passing-parameters-from-the-task-pane-frame">Passing Parameters from the Task Pane frame</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-the-active-selection">Working with the Active Selection</a><ul>
<li><a class="reference internal" href="#example-listing-selected-parcels">Example: Listing Selected Parcels</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-the-active-selection-with-the-web-api">Setting the Active Selection with the Web API</a></li>
<li><a class="reference internal" href="#example-setting-the-active-selection">Example: Setting the Active Selection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="interacting_with_layers.html"
                        title="previous chapter">Interacting With Layers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="modifying_maps_and_layers.html"
                        title="next chapter">Modifying Maps and Layers</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/working_with_feature_data.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="working-with-feature-data">
<h1>Working With Feature Data<a class="headerlink" href="#working-with-feature-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview-of-features">
<h2>Overview of Features<a class="headerlink" href="#overview-of-features" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Working With Feature Data sample, in the Developer&#8217;s Guide samples,
demonstrates concepts from this chapter.</p>
</div>
<p>Understanding features is fundamental to being able to use the MapGuide Web
API. Nearly every application will need to interact with feature data in one form
or another.</p>
<p><em>Features</em> are map objects representing items like roads (polylines), lakes
(polygons), or locations (points).</p>
<p>A <em>feature source</em> is a resource that contains a set of related features, stored in a
file or database. Some common feature source types are SDF files, SHP files, or
data in a spatial database.</p>
<p>For example, you may have a feature source that contains data for roads. Feature
sources can be stored in the library repository or in a session repository. A feature
source identifier describes a complete path in the repository. For example,</p>
<p><code class="docutils literal"><span class="pre">Library://Samples/Sheboygan/Data/RoadCenterLines.FeatureSource</span></code></p>
<p>Within a single feature source there may be one or more <em>feature classes</em>. A feature
class describes a subset of the features in the feature source. In many cases, there
is one feature class for each feature source. For example, there may be a Roads
feature class in the RoadCenterLines feature source.</p>
<p>A feature class contains one or more features. Each feature has a geometry that
defines the spatial representation of the feature. Features will also generally
have one or more properties that provide additional information. For example,
a feature class containing road data may have properties for the road name
and the number of lanes. Feature properties can be of different types, like
strings, integers, and floating point numbers. Possible types are defined in the
class <code class="docutils literal"><span class="pre">MgPropertyType</span></code>.</p>
<p>In some cases, a feature property will be another feature. For example, a Roads
feature might have a Sidewalk feature as one of its properties.</p>
<p>A map layer may contain the features from a feature class. The features are
rendered using the feature geometry.</p>
<p>The Web API Feature Service provides functions for querying and updating
feature data.</p>
</div>
<div class="section" id="querying-feature-data">
<span id="index-0"></span><span id="id1"></span><h2>Querying Feature Data<a class="headerlink" href="#querying-feature-data" title="Permalink to this headline">¶</a></h2>
<p>In order to work with feature data, you must first select the features you are
interested in. This can be done with the Viewer or through Web API calls.</p>
<div class="section" id="feature-readers">
<span id="index-1"></span><h3>Feature Readers<a class="headerlink" href="#feature-readers" title="Permalink to this headline">¶</a></h3>
<p>A <em>feature reader</em>, represented by an <code class="docutils literal"><span class="pre">MgFeatureReader</span></code> object, is used to iterate
through a list of features. Typically, the feature reader is created by selecting
features from a feature source.</p>
<p>To create a feature reader, use the <code class="docutils literal"><span class="pre">MgFeatureService::SelectFeatures()</span></code>
method. See <a class="reference internal" href="#selecting-with-web-api"><span class="std std-ref">Selecting with the Web API</span></a> details about selection.</p>
<p>To process the features in a feature reader, use the
<code class="docutils literal"><span class="pre">MgFeatureReader::ReadNext()</span></code> method. You must call this method before
being able to read the first feature. Continue calling the method to process
the rest of the features.</p>
<p>The <code class="docutils literal"><span class="pre">MgFeatureReader::GetPropertyCount()</span></code> method returns the number of
properties available for the current feature. When you know the name and
type of the feature property, call one of the <code class="docutils literal"><span class="pre">MgFeatureReader::GetPropertyType()</span></code>
methods (where PropertyType represents one of the available types) to retrieve the value.
Otherwise, call <code class="docutils literal"><span class="pre">MgFeatureReader::GetPropertyName()</span></code> and
<code class="docutils literal"><span class="pre">MgFeatureReader::GetPropertyType()</span></code> before retrieving the value.</p>
<div class="admonition note" id="index-2">
<p class="first admonition-title">Note</p>
<p class="last">You should always call <code class="docutils literal"><span class="pre">Close()</span></code> on your <code class="docutils literal"><span class="pre">MgFeatureReader</span></code> objects (or any object derived from <code class="docutils literal"><span class="pre">MgReader</span></code> for that matter)
as memory leaks can happen because of unclosed reader objects. Another common pitfall is the <code class="docutils literal"><span class="pre">Close()</span></code> call not being called because
the code before it threw an exception. For .net and Java, you can use the a <code class="docutils literal"><span class="pre">try...finally</span></code> block
to ensure your reader will always be closed regardless of whether exceptions have been thrown or not.</p>
</div>
<div class="admonition note" id="index-3">
<p class="first admonition-title">Note</p>
<p class="last">Always check if the property whose value you are trying to retrive is null using the <code class="docutils literal"><span class="pre">IsNull()</span></code> method before attempting to access the property value.
Attempting to access a null property value will cause the reader to throw a <code class="docutils literal"><span class="pre">MgNullPropertyValueException</span></code></p>
</div>
</div>
<div class="section" id="selecting-with-the-web-api">
<span id="selecting-with-web-api"></span><span id="index-4"></span><h3>Selecting with the Web API<a class="headerlink" href="#selecting-with-the-web-api" title="Permalink to this headline">¶</a></h3>
<p>Selections can be created programatically with the Web API. This is done by
querying data in a feature source, creating a feature reader that contains the
features, then converting the feature reader to a selection (<code class="docutils literal"><span class="pre">MgSelection</span></code> object).</p>
<p>To create a feature reader, apply a selection filter to a feature class in the feature
source. A selection filter can be a basic filter, a spatial filter, or a combination
of the two. The filter is stored in an <code class="docutils literal"><span class="pre">MgFeatureQueryOptions</span></code> object.</p>
<p>Basic filters are used to select features based on the values of feature properties.
For example, you could use a basic filter to select all roads that have four or
more lanes.</p>
<p>Spatial filters are used to select features based on their geometry. For example,
you could use a spatial filter to select all roads that intersect a certain area.</p>
<div class="section" id="basic-filters">
<span id="index-5"></span><h4>Basic Filters<a class="headerlink" href="#basic-filters" title="Permalink to this headline">¶</a></h4>
<p>Basic filters perform logical tests of feature properties. You can construct
complex queries by combining expressions. Expressions use the comparison
operators below:</p>
<table border="1" class="docutils" id="index-6">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operator</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>=</td>
<td>Equality</td>
</tr>
<tr class="row-odd"><td>&lt;&gt;</td>
<td>Not Equal</td>
</tr>
<tr class="row-even"><td>&lt;</td>
<td>Less Than</td>
</tr>
<tr class="row-odd"><td>&lt;=</td>
<td>Less Than or Equal To</td>
</tr>
<tr class="row-even"><td>&gt;</td>
<td>Greater Than</td>
</tr>
<tr class="row-odd"><td>&gt;=</td>
<td>Greater Than or Equal To</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">LIKE</span></code></td>
<td>Used for string comparisons. The &#8220;%&#8221;
wildcard represents any sequence of 0 or
more characters. The &#8220;_&#8221; wildcard
represents any single character. For
example, <code class="docutils literal"><span class="pre">LIKE</span> <span class="pre">'SCHMITT%'</span></code> will begin
search for any names beginning with
<code class="docutils literal"><span class="pre">SCHMITT</span></code></td>
</tr>
</tbody>
</table>
<p>The comparison operators can be used with numeric or string properties,
except for the <code class="docutils literal"><span class="pre">LIKE</span></code> operator, which can only be used with string properties.</p>
<p>Combine or modify expressions with the standard boolean operators <code class="docutils literal"><span class="pre">AND</span></code>, <code class="docutils literal"><span class="pre">OR</span></code>,
and <code class="docutils literal"><span class="pre">NOT</span></code>.</p>
<p><strong>Examples</strong></p>
<p>These examples assume that the feature class you are querying has an integer
property named year and a string property named owner. To select all features
newer than 2001, create a filter like this:</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s1">&#39;year &gt; 2001&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="n">queryOptions</span><span class="p">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="s">&quot;year &gt; 2001&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the org.osgeo.mapguide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="o">();</span>
<span class="n">queryOptions</span><span class="o">.</span><span class="na">SetFilter</span><span class="o">(</span><span class="s">&quot;year &gt; 2001&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>To select all features built between 2001 and 2004, create a filter like this:</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s1">&#39;year &gt;= 2001 and year &lt;= 2004&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="n">queryOptions</span><span class="p">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="s">&quot;year &gt;= 2001 and year &lt;= 2004&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the org.osgeo.mapguide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="o">();</span>
<span class="n">queryOptions</span><span class="o">.</span><span class="na">SetFilter</span><span class="o">(</span><span class="s">&quot;year &gt;= 2001 and year &lt;= 2004&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>To select all features owned by Davis or Davies, create a filter like this:</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s2">&quot;owner LIKE &#39;Davi%s&#39;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="n">queryOptions</span><span class="p">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="s">&quot;owner LIKE &#39;Davi%s&#39;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the org.osgeo.mapguide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="o">();</span>
<span class="n">queryOptions</span><span class="o">.</span><span class="na">SetFilter</span><span class="o">(</span><span class="s">&quot;owner LIKE &#39;Davi%s&#39;&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="spatial-filters">
<span id="index-7"></span><h4>Spatial Filters<a class="headerlink" href="#spatial-filters" title="Permalink to this headline">¶</a></h4>
<p>With spatial filters, you can do comparisons using geometric properties. For
example, you can select all features that are inside an area on the map, or that
intersect an area.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information about geometry, see <a class="reference internal" href="analyzing_features.html#representations-of-geometry"><span class="std std-ref">Representations of Geometry</span></a>.</p>
</div>
<p>There are two ways of using spatial filters:</p>
<blockquote>
<div><ul class="simple">
<li>Create a separate spatial filter to apply to the feature source, using the
<code class="docutils literal"><span class="pre">MgFeatureQueryOptions::SetSpatialFilter()</span></code> method.</li>
<li>Include spatial properties in a basic filter created with the <code class="docutils literal"><span class="pre">MgFeatureQueryOptions::SetFilter()</span></code> method.</li>
</ul>
</div></blockquote>
<p>The <code class="docutils literal"><span class="pre">MgFeatureQueryOptions::SetSpatialFilter()</span></code> method requires an
<code class="docutils literal"><span class="pre">MgGeometry</span></code> object to define the geometry and a spatial operation to compare
the feature property and the geometry. The spatial operations are defined in
class <code class="docutils literal"><span class="pre">MgFeatureSpatialOperations</span></code>.</p>
<p id="index-8">To include spatial properties in a basic filter, define the geometry using WKT
format. Use the <code class="docutils literal"><span class="pre">GEOMFROMTEXT()</span></code> function in the basic filter, along with one
of the following spatial operations:</p>
<blockquote>
<div><ul class="simple">
<li>CONTAINS</li>
<li>COVEREDBY</li>
<li>CROSSES</li>
<li>DISJOINT</li>
<li>EQUALS</li>
<li>INTERSECTS</li>
<li>OVERLAPS</li>
<li>TOUCHES</li>
<li>WITHIN</li>
<li>INSIDE</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all spatial operations can be used on all features. It depends on the
capabilities of the FDO provider that supplies the data. This restriction applies to
separate spatial filters and spatial properties that are used in a basic filter.</p>
</div>
<p id="index-9"><strong>Creating Geometry Objects from Features</strong></p>
<p>You may want to use an existing feature as part of a spatial query. To retrieve
the feature&#8217;s geometry and convert it into an appropriate format for a query,
perform the following steps:</p>
<blockquote>
<div><ul class="simple">
<li>Create a query that will select the feature.</li>
<li>Query the feature class containing the feature using the
<code class="docutils literal"><span class="pre">MgFeatureService::SelectFeatures()</span></code> method.</li>
<li>Obtain the feature from the query using the <code class="docutils literal"><span class="pre">MgFeatureReader::ReadNext()</span></code>
method.</li>
<li>Get the geometry data from the feature using the
<code class="docutils literal"><span class="pre">MgFeatureReader::GetGeometry()</span></code> method. This data is in AGF binary
format.</li>
<li>Convert the AGF data to an <code class="docutils literal"><span class="pre">MgGeometry</span></code> object using the
<code class="docutils literal"><span class="pre">MgAgfReaderWriter::Read()</span></code> method.</li>
</ul>
</div></blockquote>
<p>For example, the following sequence creates an <code class="docutils literal"><span class="pre">MgGeometry</span></code> object representing
the boundaries of District 6 in the Sheboygan sample data.</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$districtQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="nv">$districtQuery</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s2">&quot;ID = &#39;1&#39;&quot;</span><span class="p">);</span>
<span class="nv">$layer</span> <span class="o">=</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">GetLayers</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">GetItem</span><span class="p">(</span><span class="s1">&#39;Districts&#39;</span><span class="p">);</span>
<span class="nv">$featureReader</span> <span class="o">=</span> <span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">SelectFeatures</span><span class="p">(</span><span class="nv">$districtQuery</span><span class="p">);</span>
<span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">ReadNext</span><span class="p">();</span>
<span class="nv">$districtGeometryData</span> <span class="o">=</span> <span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">GetGeometry</span><span class="p">(</span><span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">GetFeatureGeometryName</span><span class="p">());</span>
<span class="nv">$agfReaderWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgAgfReaderWriter</span><span class="p">();</span>
<span class="nv">$districtGeometry</span> <span class="o">=</span> <span class="nv">$agfReaderWriter</span><span class="o">-&gt;</span><span class="na">Read</span><span class="p">(</span><span class="nv">$districtGeometryData</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">districtQuery</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="n">districtQuery</span><span class="p">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="s">&quot;ID = &#39;1&#39;&quot;</span><span class="p">);</span>
<span class="n">MgLayer</span> <span class="n">layer</span> <span class="p">=</span> <span class="p">(</span><span class="n">MgLayer</span><span class="p">)</span><span class="n">map</span><span class="p">.</span><span class="n">GetLayers</span><span class="p">().</span><span class="n">GetItem</span><span class="p">(</span><span class="s">&quot;Districts&quot;</span><span class="p">);</span>
<span class="n">MgFeatureReader</span> <span class="n">featureReader</span> <span class="p">=</span> <span class="n">layer</span><span class="p">.</span><span class="n">SelectFeatures</span><span class="p">(</span><span class="n">districtQuery</span><span class="p">);</span>
<span class="n">featureReader</span><span class="p">.</span><span class="n">ReadNext</span><span class="p">();</span>
<span class="n">MgByteReader</span> <span class="n">districtGeometryData</span> <span class="p">=</span> <span class="n">featureReader</span><span class="p">.</span><span class="n">GetGeometry</span><span class="p">(</span><span class="n">layer</span><span class="p">.</span><span class="n">GetFeatureGeometryName</span><span class="p">());</span>
<span class="n">MgAgfReaderWriter</span> <span class="n">agfReaderWriter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgAgfReaderWriter</span><span class="p">();</span>
<span class="n">MgGeometry</span> <span class="n">districtGeometry</span> <span class="p">=</span> <span class="n">agfReaderWriter</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">districtGeometryData</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the org.osgeo.mapguide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">districtQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="o">();</span>
<span class="n">districtQuery</span><span class="o">.</span><span class="na">SetFilter</span><span class="o">(</span><span class="s">&quot;Autogenerated_SDF_ID = 1&quot;</span><span class="o">);</span>
<span class="n">MgLayer</span> <span class="n">layer</span> <span class="o">=</span> <span class="o">(</span><span class="n">MgLayer</span><span class="o">)</span><span class="n">map</span><span class="o">.</span><span class="na">GetLayers</span><span class="o">().</span><span class="na">GetItem</span><span class="o">(</span><span class="s">&quot;Districts&quot;</span><span class="o">);</span>
<span class="n">MgFeatureReader</span> <span class="n">featureReader</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="na">SelectFeatures</span><span class="o">(</span><span class="n">districtQuery</span><span class="o">);</span>
<span class="n">featureReader</span><span class="o">.</span><span class="na">ReadNext</span><span class="o">();</span>
<span class="n">MgByteReader</span> <span class="n">districtGeometryData</span> <span class="o">=</span> <span class="n">featureReader</span><span class="o">.</span><span class="na">GetGeometry</span><span class="o">(</span><span class="n">layer</span><span class="o">.</span><span class="na">GetFeatureGeometryName</span><span class="o">());</span>
<span class="n">MgAgfReaderWriter</span> <span class="n">agfReaderWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgAgfReaderWriter</span><span class="o">();</span>
<span class="n">MgGeometry</span> <span class="n">districtGeometry</span> <span class="o">=</span> <span class="n">agfReaderWriter</span><span class="o">.</span><span class="na">Read</span><span class="o">(</span><span class="n">districtGeometryData</span><span class="o">);</span>
</pre></div>
</div>
<p id="index-10">To convert an <code class="docutils literal"><span class="pre">MgGeometry</span></code> object into its WKT representation, use the <code class="docutils literal"><span class="pre">MgWktReaderWriter::Write()</span></code> method, as in the following example:</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$wktReaderWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgWktReaderWriter</span><span class="p">();</span>
<span class="nv">$districtWkt</span> <span class="o">=</span> <span class="nv">$wktReaderWriter</span><span class="o">-&gt;</span><span class="na">Write</span><span class="p">(</span><span class="nv">$districtGeometry</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgWktReaderWriter</span> <span class="n">wktReaderWriter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgWktReaderWriter</span><span class="p">();</span>
<span class="n">String</span> <span class="n">districtWkt</span> <span class="p">=</span> <span class="n">wktReaderWriter</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">districtGeometry</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the org.osgeo.mapguide namespace</span>
<span class="n">MgWktReaderWriter</span> <span class="n">wktReaderWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgWktReaderWriter</span><span class="o">();</span>
<span class="n">String</span> <span class="n">districtWkt</span> <span class="o">=</span> <span class="n">wktReaderWriter</span><span class="o">.</span><span class="na">Write</span><span class="o">(</span><span class="n">districtGeometry</span><span class="o">);</span>
</pre></div>
</div>
<p><strong>Examples</strong></p>
<p>The following examples assume that <code class="docutils literal"><span class="pre">$testArea</span></code> is an <code class="docutils literal"><span class="pre">MgGeometry</span></code> object
defining a polygon, and <code class="docutils literal"><span class="pre">$testAreaWkt</span></code> is a WKT description of the polygon.</p>
<p>To create a filter to find all properties owned by <code class="docutils literal"><span class="pre">SCHMITT</span></code> in the area, use
either of the following sequences:</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s2">&quot;RNAME LIKE &#39;SCHMITT%&#39;&quot;</span><span class="p">);</span>
<span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetSpatialFilter</span><span class="p">(</span><span class="s1">&#39;SHPGEOM&#39;</span><span class="p">,</span> <span class="nv">$testArea</span><span class="p">,</span>
<span class="nx">MgFeatureSpatialOperations</span><span class="o">::</span><span class="na">Inside</span><span class="p">);</span>

<span class="nv">$queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s2">&quot;RNAME LIKE &#39;SCHMITT%&#39;</span>
<span class="s2">AND SHPGEOM inside GEOMFROMTEXT(&#39;</span><span class="si">$testAreaWkt</span><span class="s2">&#39;)&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//These code fragments assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="n">queryOptions</span><span class="p">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="s">&quot;RNAME LIKE &#39;SCHMITT%&#39;&quot;</span><span class="p">);</span>
<span class="n">queryOptions</span><span class="p">.</span><span class="n">SetSpatialFilter</span><span class="p">(</span><span class="s">&quot;SHPGEOM&quot;</span><span class="p">,</span> <span class="n">testArea</span><span class="p">,</span> <span class="n">MgFeatureSpatialOperations</span><span class="p">.</span><span class="n">Inside</span><span class="p">);</span>

<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="n">queryOptions</span><span class="p">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="s">&quot;RNAME LIKE &#39;SCHMITT%&#39; AND SHPGEOM inside GEOMFROMTEXT(&#39;&quot;</span> <span class="p">+</span> <span class="n">testAreaWkt</span> <span class="p">+</span> <span class="s">&quot;&#39;)&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//These code fragments assumes you have imported the org.osgeo.mapguide namespace</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="o">();</span>
<span class="n">queryOptions</span><span class="o">.</span><span class="na">SetFilter</span><span class="o">(</span><span class="s">&quot;RNAME LIKE &#39;SCHMITT%&#39;&quot;</span><span class="o">);</span>
<span class="n">queryOptions</span><span class="o">.</span><span class="na">SetSpatialFilter</span><span class="o">(</span><span class="s">&quot;SHPGEOM&quot;</span><span class="o">,</span> <span class="n">testArea</span><span class="o">,</span> <span class="n">MgFeatureSpatialOperations</span><span class="o">.</span><span class="na">Inside</span><span class="o">);</span>

<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="o">();</span>
<span class="n">queryOptions</span><span class="o">.</span><span class="na">SetFilter</span><span class="o">(</span><span class="s">&quot;RNAME LIKE &#39;SCHMITT%&#39; AND SHPGEOM inside GEOMFROMTEXT(&#39;&quot;</span> <span class="o">+</span> <span class="n">testAreaWkt</span> <span class="o">+</span> <span class="s">&quot;&#39;)&quot;</span><span class="o">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-selection">
<span id="index-11"></span><span id="id2"></span><h3>Example: Selection<a class="headerlink" href="#example-selection" title="Permalink to this headline">¶</a></h3>
<p>The following example creates a selection, then lists properties from the
selected features. See the Working With Feature Data sample, in the Developer&#8217;s
Guide samples, for the complete version.</p>
<p>It selects parcels within the boundaries of District 6 that are owned by
<code class="docutils literal"><span class="pre">SCHMITT</span></code>. This requires a spatial filter and a basic filter.</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgMap</span><span class="p">(</span><span class="nv">$siteConnection</span><span class="p">);</span>
<span class="nv">$map</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">(</span><span class="nv">$mapName</span><span class="p">);</span>

<span class="c1">// Get the geometry for the boundaries of District 6</span>

<span class="nv">$districtQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="nv">$districtQuery</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s2">&quot;ID = &#39;6&#39;&quot;</span><span class="p">);</span>

<span class="nv">$layer</span> <span class="o">=</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">GetLayers</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">GetItem</span><span class="p">(</span><span class="s1">&#39;Districts&#39;</span><span class="p">);</span>
<span class="nv">$featureReader</span> <span class="o">=</span> <span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">SelectFeatures</span><span class="p">(</span><span class="nv">$districtQuery</span><span class="p">);</span>
<span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">ReadNext</span><span class="p">();</span>
<span class="nv">$districtGeometryData</span> <span class="o">=</span> <span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">GetGeometry</span><span class="p">(</span><span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">GetFeatureGeometryName</span><span class="p">());</span>
<span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">Close</span><span class="p">();</span>

<span class="c1">// Convert the AGF binary data to MgGeometry.</span>

<span class="nv">$agfReaderWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgAgfReaderWriter</span><span class="p">();</span>
<span class="nv">$districtGeometry</span> <span class="o">=</span> <span class="nv">$agfReaderWriter</span><span class="o">-&gt;</span>
<span class="na">Read</span><span class="p">(</span><span class="nv">$districtGeometryData</span><span class="p">);</span>

<span class="c1">// Create a filter to select the desired features.</span>
<span class="c1">// Combine a basic filter and a spatial filter.</span>

<span class="nv">$queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s2">&quot;RNAME LIKE &#39;SCHMITT%&#39;&quot;</span><span class="p">);</span>

<span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetSpatialFilter</span><span class="p">(</span><span class="s1">&#39;SHPGEOM&#39;</span><span class="p">,</span> <span class="nv">$districtGeometry</span><span class="p">,</span> <span class="nx">MgFeatureSpatialOperations</span><span class="o">::</span><span class="na">Inside</span><span class="p">);</span>

<span class="c1">// Select the features.</span>

<span class="nv">$layer</span> <span class="o">=</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">GetLayers</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">GetItem</span><span class="p">(</span><span class="s1">&#39;Parcels&#39;</span><span class="p">);</span>
<span class="nv">$featureReader</span> <span class="o">=</span> <span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">SelectFeatures</span><span class="p">(</span><span class="nv">$queryOptions</span><span class="p">);</span>

<span class="c1">// For each selected feature, display the address.</span>

<span class="k">echo</span> <span class="s1">&#39;&lt;p&gt;Properties owned by Schmitt &#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;in District 6&lt;/p&gt;&lt;p&gt;&#39;</span><span class="p">;</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">ReadNext</span><span class="p">())</span>
<span class="p">{</span>
    <span class="nv">$val</span> <span class="o">=</span> <span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">GetString</span><span class="p">(</span><span class="s1">&#39;RPROPAD&#39;</span><span class="p">);</span>
    <span class="k">echo</span> <span class="nv">$val</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">Close</span><span class="p">();</span>
<span class="k">echo</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">// This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgMap</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgMap</span><span class="p">(</span><span class="n">siteConnection</span><span class="p">);</span>
<span class="n">map</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">mapName</span><span class="p">);</span>

<span class="c1">// Get the geometry for the boundaries of District 6</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">districtQuery</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="n">districtQuery</span><span class="p">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="s">&quot;ID = &#39;6&#39;&quot;</span><span class="p">);</span>

<span class="n">MgLayer</span> <span class="n">layer</span> <span class="p">=</span> <span class="p">(</span><span class="n">MgLayer</span><span class="p">)</span><span class="n">map</span><span class="p">.</span><span class="n">GetLayers</span><span class="p">().</span><span class="n">GetItem</span><span class="p">(</span><span class="s">&quot;Districts&quot;</span><span class="p">);</span>
<span class="n">MgFeatureReader</span> <span class="n">featureReader</span> <span class="p">=</span> <span class="n">layer</span><span class="p">.</span><span class="n">SelectFeatures</span><span class="p">(</span><span class="n">districtQuery</span><span class="p">);</span>
<span class="n">featureReader</span><span class="p">.</span><span class="n">ReadNext</span><span class="p">();</span>
<span class="n">MgByteReader</span> <span class="n">districtGeometryData</span> <span class="p">=</span> <span class="n">featureReader</span><span class="p">.</span><span class="n">GetGeometry</span><span class="p">(</span><span class="n">layer</span><span class="p">.</span><span class="n">GetFeatureGeometryName</span><span class="p">());</span>
<span class="n">featureReader</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>

<span class="c1">// Convert the AGF binary data to MgGeometry</span>
<span class="n">MgAgfReaderWriter</span> <span class="n">agfReaderWriter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgAgfReaderWriter</span><span class="p">();</span>
<span class="n">MgGeometry</span> <span class="n">districtGeometry</span> <span class="p">=</span> <span class="n">agfReaderWriter</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">districtGeometryData</span><span class="p">);</span>

<span class="c1">// Create a filter to select the desired features.</span>
<span class="c1">// Combine a basic filter and spatial filter.</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="p">();</span>
<span class="n">queryOptions</span><span class="p">.</span><span class="n">SetFilter</span><span class="p">(</span><span class="s">&quot;RNAME LIKE &#39;SCHMITT%&#39;&quot;</span><span class="p">);</span>

<span class="n">queryOptions</span><span class="p">.</span><span class="n">SetSpatialFilter</span><span class="p">(</span><span class="s">&quot;SHPGEOM&quot;</span><span class="p">,</span> <span class="n">districtGeometry</span><span class="p">,</span> <span class="n">MgFeatureSpatialOperations</span><span class="p">.</span><span class="n">Inside</span><span class="p">);</span>

<span class="c1">// Select the features</span>
<span class="n">layer</span> <span class="p">=</span> <span class="p">(</span><span class="n">MgLayer</span><span class="p">)</span><span class="n">map</span><span class="p">.</span><span class="n">GetLayers</span><span class="p">().</span><span class="n">GetItem</span><span class="p">(</span><span class="s">&quot;Parcels&quot;</span><span class="p">);</span>
<span class="n">featureReader</span> <span class="p">=</span> <span class="n">layer</span><span class="p">.</span><span class="n">SelectFeatures</span><span class="p">(</span><span class="n">queryOptions</span><span class="p">);</span>

<span class="c1">// For each selected feature, display the address</span>

<span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;&lt;p&gt;Properties owned by Schmitt &quot;</span><span class="p">);</span>
<span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;in District 6&lt;/p&gt;&lt;p&gt;&quot;</span><span class="p">);</span>

<span class="k">while</span> <span class="p">(</span><span class="n">featureReader</span><span class="p">.</span><span class="n">ReadNext</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">String</span> <span class="n">val</span> <span class="p">=</span> <span class="n">featureReader</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="s">&quot;RPROPAD&quot;</span><span class="p">);</span>
    <span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">val</span> <span class="p">+</span> <span class="s">&quot;&lt;br/&gt;&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">featureReader</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
<span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;&lt;/p&gt;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the org.osgeo.mapguide namespace</span>
<span class="n">MgMap</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgMap</span><span class="o">(</span><span class="n">siteConnection</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">Open</span><span class="o">(</span><span class="n">mapName</span><span class="o">);</span>

<span class="c1">// Get the geometry for the boundaries of District 6</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">districtQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="o">();</span>
<span class="n">districtQuery</span><span class="o">.</span><span class="na">SetFilter</span><span class="o">(</span><span class="s">&quot;ID = &#39;6&#39;&quot;</span><span class="o">);</span>

<span class="n">MgLayer</span> <span class="n">layer</span> <span class="o">=</span> <span class="o">(</span><span class="n">MgLayer</span><span class="o">)</span><span class="n">map</span><span class="o">.</span><span class="na">GetLayers</span><span class="o">().</span><span class="na">GetItem</span><span class="o">(</span><span class="s">&quot;Districts&quot;</span><span class="o">);</span>
<span class="n">MgFeatureReader</span> <span class="n">featureReader</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="na">SelectFeatures</span><span class="o">(</span><span class="n">districtQuery</span><span class="o">);</span>
<span class="n">featureReader</span><span class="o">.</span><span class="na">ReadNext</span><span class="o">();</span>
<span class="n">MgByteReader</span> <span class="n">districtGeometryData</span> <span class="o">=</span> <span class="n">featureReader</span><span class="o">.</span><span class="na">GetGeometry</span><span class="o">(</span><span class="n">layer</span><span class="o">.</span><span class="na">GetFeatureGeometryName</span><span class="o">());</span>
<span class="n">featureReader</span><span class="o">.</span><span class="na">Close</span><span class="o">();</span>

<span class="c1">// Convert the AGF binary data to MgGeometry</span>
<span class="n">MgAgfReaderWriter</span> <span class="n">agfReaderWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgAgfReaderWriter</span><span class="o">();</span>
<span class="n">MgGeometry</span> <span class="n">districtGeometry</span> <span class="o">=</span> <span class="n">agfReaderWriter</span><span class="o">.</span><span class="na">Read</span><span class="o">(</span><span class="n">districtGeometryData</span><span class="o">);</span>

<span class="c1">// Create a filter to select the desired features.</span>
<span class="c1">// Combine a basic filter and spatial filter.</span>
<span class="n">MgFeatureQueryOptions</span> <span class="n">queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgFeatureQueryOptions</span><span class="o">();</span>
<span class="n">queryOptions</span><span class="o">.</span><span class="na">SetFilter</span><span class="o">(</span><span class="s">&quot;RNAME LIKE &#39;SCHMITT%&#39;&quot;</span><span class="o">);</span>

<span class="n">queryOptions</span><span class="o">.</span><span class="na">SetSpatialFilter</span><span class="o">(</span><span class="s">&quot;SHPGEOM&quot;</span><span class="o">,</span> <span class="n">districtGeometry</span><span class="o">,</span> <span class="n">MgFeatureSpatialOperations</span><span class="o">.</span><span class="na">Inside</span><span class="o">);</span>

<span class="c1">// Select the features</span>
<span class="n">layer</span> <span class="o">=</span> <span class="o">(</span><span class="n">MgLayer</span><span class="o">)</span><span class="n">map</span><span class="o">.</span><span class="na">GetLayers</span><span class="o">().</span><span class="na">GetItem</span><span class="o">(</span><span class="s">&quot;Parcels&quot;</span><span class="o">);</span>
<span class="n">featureReader</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="na">SelectFeatures</span><span class="o">(</span><span class="n">queryOptions</span><span class="o">);</span>

<span class="c1">// For each selected feature, display the address</span>

<span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;&lt;p&gt;Properties owned by Schmitt &quot;</span><span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;in District 6&lt;/p&gt;&lt;p&gt;&quot;</span><span class="o">);</span>

<span class="k">while</span> <span class="o">(</span><span class="n">featureReader</span><span class="o">.</span><span class="na">ReadNext</span><span class="o">())</span>
<span class="o">{</span>
    <span class="n">String</span> <span class="n">val</span> <span class="o">=</span> <span class="n">featureReader</span><span class="o">.</span><span class="na">GetString</span><span class="o">(</span><span class="s">&quot;RPROPAD&quot;</span><span class="o">);</span>
    <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">val</span> <span class="o">+</span> <span class="s">&quot;&lt;br/&gt;&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">featureReader</span><span class="o">.</span><span class="na">Close</span><span class="o">();</span>
<span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;&lt;/p&gt;&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="active-selections">
<span id="index-12"></span><h2>Active Selections<a class="headerlink" href="#active-selections" title="Permalink to this headline">¶</a></h2>
<p>A map may have an active selection, which is a list of features on the map
that have been selected and highlighted in the Viewer. The active selection
is part of the run-time map state, and is not stored with the map resource in
the repository.</p>
<p>The most direct method for creating an active selection is to use the interactive
selection tools in the Viewer. Applications can also create selections using the
Web API and apply them to a user&#8217;s view of the map.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the AJAX Viewer, any changes to the active selection require re-generation
of the map image. Because of this, the Web server keeps information about
the selection.</p>
</div>
<div class="section" id="selecting-with-the-viewer">
<span id="index-13"></span><h3>Selecting with the Viewer<a class="headerlink" href="#selecting-with-the-viewer" title="Permalink to this headline">¶</a></h3>
<p>In order for a feature to be selectable using the Viewer, the following criteria
must be met:</p>
<blockquote>
<div><ul class="simple">
<li>The layer containing the feature must be visible at the current map view scale.</li>
<li>The selectable property for the layer must be true. Change this property in the web layout or with the <code class="docutils literal"><span class="pre">MgLayer::SetSelectable()</span></code> method.</li>
</ul>
</div></blockquote>
<p>There are different selection tools available in the Viewer. They can be enabled
or disabled as part of the web layout. Each tool allows a user to select one or
more features on the map.</p>
</div>
<div class="section" id="passing-viewer-information-to-the-web-server">
<span id="index-14"></span><h3>Passing Viewer Information to the Web Server<a class="headerlink" href="#passing-viewer-information-to-the-web-server" title="Permalink to this headline">¶</a></h3>
<p>The stateless nature of HTTP means that when the Viewer makes a request to a MapGuide Server Page
on the Web Server, it must often pass information as part of the request. Some
common methods for passing this information are:</p>
<blockquote>
<div><ul class="simple">
<li>as an additional parameter to an Invoke URL command in a web layout</li>
<li>through an Invoke Script command that executes the <code class="docutils literal"><span class="pre">Submit</span></code> method of the hidden <code class="docutils literal"><span class="pre">formFrame</span></code></li>
<li>through an <code class="docutils literal"><span class="pre">onClick</span></code> or other event that executes the <code class="docutils literal"><span class="pre">Submit</span></code> method of the hidden <code class="docutils literal"><span class="pre">formFrame</span></code></li>
</ul>
</div></blockquote>
<p>The best method to use depends on the requirements of the application. If
you are invoking the request from a command defined in a web layout, you
can pass the information either as an additional parameter to an Invoke URL
command or through an Invoke Script command. Invoke URL is simpler, but
it offers a restricted set of parameters. Invoke Script has complete access to all
the JavaScript calls in the Viewer API.</p>
<p>If you are invoking the request from a page in the task pane, you can execute
JavaScript as part of an <code class="docutils literal"><span class="pre">onClick</span></code> event or a form action.</p>
<div class="section" id="additional-parameters-to-an-invoke-url-command">
<span id="index-16"></span><h4>Additional Parameters to an Invoke URL Command<a class="headerlink" href="#additional-parameters-to-an-invoke-url-command" title="Permalink to this headline">¶</a></h4>
<p>With this release of MapGuide, the current selection is the only variable that
can be passed as part of an Invoke URL command.</p>
<p>To pass the current selection, edit the web layout. Define a new Invoke URL
command. On the Additional Parameters tab, enter a key and value. The key
must be a valid HTTP POST key. For the value, enter <code class="docutils literal"><span class="pre">$CurrentSelection</span></code>. Add
the command to the toolbar, context menu, or task bar menu.</p>
<p>When the command is executed, the current selection is passed to the page,
along with the standard variables like <code class="docutils literal"><span class="pre">SESSION</span></code> and <code class="docutils literal"><span class="pre">MAPNAME</span></code>.</p>
<p>For example, if you define the key <code class="docutils literal"><span class="pre">SEL</span></code> to have the value <code class="docutils literal"><span class="pre">$CurrentSelection</span></code>,
then when the URL is invoked</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$selection</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;SEL&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="n">String</span> <span class="n">selection</span> <span class="p">=</span> <span class="n">Request</span><span class="p">.</span><span class="n">Form</span><span class="p">[</span><span class="s">&quot;SEL&quot;</span><span class="p">];</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">String</span> <span class="n">selection</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;SEL&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>gets the current selection, in XML format.</p>
<p>See <a class="reference internal" href="#working-with-the-active-selection"><span class="std std-ref">Working with the Active Selection</span></a> for details about using the
XML data.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The AJAX automatically adds the following parameters for any Invoke URL command:</p>
<blockquote class="last">
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">SESSION</span></code> - The current session id</li>
<li><code class="docutils literal"><span class="pre">MAPNAME</span></code> - The name of the current map. Use this for the <code class="docutils literal"><span class="pre">MgMap::Open()</span></code> method</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="passing-parameters-from-an-invoke-script-command">
<span id="index-17"></span><h4>Passing Parameters from an Invoke Script Command<a class="headerlink" href="#passing-parameters-from-an-invoke-script-command" title="Permalink to this headline">¶</a></h4>
<p>An Invoke Script command in a web layout can be used to pass custom
parameters to a page. The parameters can be any values that are available via
the Viewer API.</p>
<p>To pass parameters, edit the web layout. Define a new Invoke Script command.
On the Additional Parameters tab, enter the JavaScript code to retrieve the
values to be passed. Add the command to the toolbar, context menu, or task
bar menu.</p>
<p>The JavaScript code can call Viewer API functions or other functions to retrieve
values. To pass the parameters to a page, call the <code class="docutils literal"><span class="pre">Submit</span></code> method of the
<code class="docutils literal"><span class="pre">formFrame</span></code> with the parameters, the page URL, and the name of the target
frame. Use <code class="docutils literal"><span class="pre">taskPaneFrame</span></code> or <code class="docutils literal"><span class="pre">scriptFrame</span></code> as the target frame, depending
whether the loaded page should be visible or not.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The parameters must include standard parameters like <code class="docutils literal"><span class="pre">SESSION</span></code> and <code class="docutils literal"><span class="pre">MAPNAME</span></code>, if they are needed.</p>
</div>
</div>
<div class="section" id="passing-parameters-from-the-task-pane-frame">
<span id="index-18"></span><h4>Passing Parameters from the Task Pane frame<a class="headerlink" href="#passing-parameters-from-the-task-pane-frame" title="Permalink to this headline">¶</a></h4>
<p>Passing parameters from the task pane frame is similar to passing them from
an Invoke Script command. Use the Viewer API to retrieve values and call the
<code class="docutils literal"><span class="pre">Submit</span></code> method of the <code class="docutils literal"><span class="pre">formFrame</span></code> to pass the values to another page.</p>
<p>For example, the following function passes the map view scale and the center
point as parameters to a page that opens in a new window.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">submitRequest</span><span class="p">(</span><span class="nx">pageUrl</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">xmlSel</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">mapFrame</span><span class="p">.</span><span class="nx">GetSelectionXML</span><span class="p">();</span>
    <span class="nx">mapScale</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">mapFrame</span><span class="p">.</span><span class="nx">GetScale</span><span class="p">();</span>
    <span class="nx">mapCenter</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">mapFrame</span><span class="p">.</span><span class="nx">GetCenter</span><span class="p">();</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span>
        <span class="s2">&quot;SESSION&quot;</span><span class="p">,</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">mapFrame</span><span class="p">.</span><span class="nx">GetSessionId</span><span class="p">(),</span>
        <span class="s2">&quot;MAPNAME&quot;</span><span class="p">,</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">mapFrame</span><span class="p">.</span><span class="nx">GetMapName</span><span class="p">(),</span>
        <span class="s2">&quot;SELECTION&quot;</span><span class="p">,</span> <span class="nx">xmlSel</span><span class="p">,</span>
        <span class="s2">&quot;SCALE&quot;</span><span class="p">,</span> <span class="nx">mapScale</span><span class="p">,</span>
        <span class="s2">&quot;CENTERX&quot;</span><span class="p">,</span> <span class="nx">mapCenter</span><span class="p">.</span><span class="nx">X</span><span class="p">,</span>
        <span class="s2">&quot;CENTERY&quot;</span><span class="p">,</span> <span class="nx">mapCenter</span><span class="p">.</span><span class="nx">Y</span>
    <span class="p">);</span>
    <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">formFrame</span><span class="p">.</span><span class="nx">Submit</span><span class="p">(</span><span class="nx">pageUrl</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="s2">&quot;_blank&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To call the function, execute it as part of an onClick event or as the action in
a form. For example, clicking the following link would execute the function:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onClick=</span><span class="s">&quot;submitRequest(&#39;/mapguide/devguide/custom_output/property_report.php&#39;); return false;&quot;</span><span class="nt">&gt;</span>Click for report<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="working-with-the-active-selection">
<span id="index-19"></span><span id="id3"></span><h3>Working with the Active Selection<a class="headerlink" href="#working-with-the-active-selection" title="Permalink to this headline">¶</a></h3>
<p>Whenever a selection is changed by the Viewer, the selection information is sent to the web server so the map can be re-generated.</p>
<p>To retrieve and manipulate the active selection for a map (AJAX Viewer only):</p>
<blockquote>
<div><ol class="arabic simple">
<li>Create an <code class="docutils literal"><span class="pre">MgSelection</span></code> object for the map. Initialize it to the active selection.</li>
<li>Retrieve selected layers from the <code class="docutils literal"><span class="pre">MgSelection</span></code> object.</li>
<li>For each layer, retrieve selected feature classes. There will normally be one feature class for the layer, so you can use the <code class="docutils literal"><span class="pre">MgSelection::GetClass()</span></code> method instead of the <code class="docutils literal"><span class="pre">MgSelection::GetClasses()</span></code> method.</li>
<li>Call <code class="docutils literal"><span class="pre">MgSelection::GenerateFilter()</span></code> to create a selection filter that contains the selected features in the class.</li>
<li>Call <code class="docutils literal"><span class="pre">MgFeatureService::SelectFeatures()</span></code> to create an MgFeatureReader object for the selected features.</li>
<li>Process the <code class="docutils literal"><span class="pre">MgFeatureReader</span></code> object, retrieving each selected feature.</li>
</ol>
</div></blockquote>
<div class="section" id="example-listing-selected-parcels">
<span id="index-20"></span><h4>Example: Listing Selected Parcels<a class="headerlink" href="#example-listing-selected-parcels" title="Permalink to this headline">¶</a></h4>
<p>The steps for listing the selected parcels for the DWF Viewer are nearly the
same as for the AJAX Viewer. The major difference is you must pass the
selection information from the Viewer to your page.</p>
<p>One method to do this is to create a JavaScript function, then call this function
from the Viewer using an Invoke Script command or as a result of an onClick
event in the task pane. For example, the task pane of the Working With Feature
Data sample contains a JavaScript function executed by an onClick event.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">listSelection</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nx">xmlSel</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">mapFrame</span><span class="p">.</span><span class="nx">GetSelectionXML</span><span class="p">();</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span>
        <span class="s2">&quot;SESSION&quot;</span><span class="p">,</span><span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">mapFrame</span><span class="p">.</span><span class="nx">GetSessionId</span><span class="p">(),</span>
        <span class="s2">&quot;MAPNAME&quot;</span><span class="p">,</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">mapFrame</span><span class="p">.</span><span class="nx">GetMapName</span><span class="p">());</span>
    <span class="nx">pageUrl</span> <span class="o">=</span> <span class="s2">&quot;/mapguide/samplesphp/working_with_feature_data/listselection.php&quot;</span><span class="p">;</span>
    <span class="nx">parent</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">formFrame</span><span class="p">.</span><span class="nx">Submit</span><span class="p">(</span><span class="nx">pageUrl</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="s2">&quot;taskPaneFrame&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This submits a request to listselection.php, which contains the following:</p>
<p><strong>PHP (listselection.php)</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgMap</span><span class="p">(</span><span class="nv">$siteConnection</span><span class="p">);</span>
<span class="nv">$map</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">(</span><span class="nv">$mapName</span><span class="p">);</span>

<span class="nv">$selection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgSelection</span><span class="p">(</span><span class="nv">$map</span><span class="p">);</span>
<span class="nv">$layers</span> <span class="o">=</span> <span class="nv">$selection</span><span class="o">-&gt;</span><span class="na">GetLayers</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$layers</span> <span class="o">&amp;&amp;</span> <span class="nv">$layers</span><span class="o">-&gt;</span><span class="na">GetCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$layers</span><span class="o">-&gt;</span><span class="na">GetCount</span><span class="p">();</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$layer</span> <span class="o">=</span> <span class="nv">$layers</span><span class="o">-&gt;</span><span class="na">GetItem</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$layer</span> <span class="o">&amp;&amp;</span> <span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">GetName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Parcels&#39;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$featureReader</span> <span class="o">=</span> <span class="nv">$selection</span><span class="o">-&gt;</span><span class="na">GetSelectedFeatures</span><span class="p">(</span><span class="nv">$layer</span><span class="p">,</span> <span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">GetFeatureClassName</span><span class="p">(),</span> <span class="k">false</span><span class="p">);</span>
            <span class="c1">// Process each item in the MgFeatureReader,</span>
            <span class="c1">// displaying the owner name</span>
            <span class="k">while</span> <span class="p">(</span><span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">ReadNext</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="nv">$val</span> <span class="o">=</span> <span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">GetString</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">)</span> <span class="o">.</span>
                <span class="s1">&#39;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&#39;</span> <span class="o">.</span>
                <span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">GetString</span><span class="p">(</span><span class="s1">&#39;RPROPAD&#39;</span><span class="p">);</span>
                <span class="k">echo</span> <span class="nv">$val</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">Close</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;No selected layers&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgMap</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgMap</span><span class="p">(</span><span class="n">siteConnetion</span><span class="p">);</span>
<span class="n">map</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">mapName</span><span class="p">);</span>

<span class="n">MgSelection</span> <span class="n">selection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgSelection</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
<span class="n">selection</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">mapName</span><span class="p">);</span>
<span class="n">MgLayerCollection</span> <span class="n">layers</span> <span class="p">=</span> <span class="n">selection</span><span class="p">.</span><span class="n">GetLayers</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">layers</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">layers</span><span class="p">.</span><span class="n">GetCount</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">layers</span><span class="p">.</span><span class="n">GetCount</span><span class="p">();</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="n">MgLayer</span> <span class="n">layer</span> <span class="p">=</span> <span class="p">(</span><span class="n">MgLayer</span><span class="p">)</span><span class="n">layers</span><span class="p">.</span><span class="n">GetItem</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">layer</span><span class="p">.</span><span class="n">GetName</span><span class="p">()</span> <span class="p">==</span> <span class="s">&quot;Parcels&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">MgFeatureReader</span> <span class="n">featureReader</span> <span class="p">=</span> <span class="n">selection</span><span class="p">.</span><span class="n">GetSelectedFeatures</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">layer</span><span class="p">.</span><span class="n">GetFeatureClassName</span><span class="p">(),</span> <span class="k">false</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">featureReader</span><span class="p">.</span><span class="n">ReadNext</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">String</span> <span class="n">val</span> <span class="p">=</span> <span class="n">featureReader</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="s">&quot;NAME&quot;</span><span class="p">)</span> <span class="p">+</span> <span class="s">&quot;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&quot;</span> <span class="p">+</span> <span class="n">featureReader</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="s">&quot;RPROPAD&quot;</span><span class="p">);</span>
                <span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">val</span> <span class="p">+</span> <span class="s">&quot;&lt;br/&gt;&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">featureReader</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="n">Response</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;No selected layers&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the org.osgeo.mapguide namespace</span>
<span class="n">MgMap</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgMap</span><span class="o">(</span><span class="n">siteConnetion</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">Open</span><span class="o">(</span><span class="n">mapName</span><span class="o">);</span>

<span class="n">MgSelection</span> <span class="n">selection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgSelection</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
<span class="n">selection</span><span class="o">.</span><span class="na">Open</span><span class="o">(</span><span class="n">mapName</span><span class="o">);</span>
<span class="n">MgLayerCollection</span> <span class="n">layers</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="na">GetLayers</span><span class="o">();</span>

<span class="k">if</span> <span class="o">(</span><span class="n">layers</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">layers</span><span class="o">.</span><span class="na">GetCount</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">layers</span><span class="o">.</span><span class="na">GetCount</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span>
    <span class="o">{</span>
        <span class="n">MgLayer</span> <span class="n">layer</span> <span class="o">=</span> <span class="o">(</span><span class="n">MgLayer</span><span class="o">)</span><span class="n">layers</span><span class="o">.</span><span class="na">GetItem</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">layer</span><span class="o">.</span><span class="na">GetName</span><span class="o">()</span> <span class="o">==</span> <span class="s">&quot;Parcels&quot;</span><span class="o">)</span>
        <span class="o">{</span>
            <span class="n">MgFeatureReader</span> <span class="n">featureReader</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="na">GetSelectedFeatures</span><span class="o">(</span><span class="n">layer</span><span class="o">,</span> <span class="n">layer</span><span class="o">.</span><span class="na">GetFeatureClassName</span><span class="o">(),</span> <span class="kc">false</span><span class="o">);</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">featureReader</span><span class="o">.</span><span class="na">ReadNext</span><span class="o">())</span>
            <span class="o">{</span>
                <span class="n">String</span> <span class="n">val</span> <span class="o">=</span> <span class="n">featureReader</span><span class="o">.</span><span class="na">GetString</span><span class="o">(</span><span class="s">&quot;NAME&quot;</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;&lt;br/&gt;&amp;nbsp;&amp;nbsp;&quot;</span> <span class="o">+</span> <span class="n">featureReader</span><span class="o">.</span><span class="na">GetString</span><span class="o">(</span><span class="s">&quot;RPROPAD&quot;</span><span class="o">);</span>
                <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">val</span> <span class="o">+</span> <span class="s">&quot;&lt;br/&gt;&quot;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">featureReader</span><span class="o">.</span><span class="na">Close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
    <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;No selected layers&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-the-active-selection-with-the-web-api">
<span id="index-23"></span><h3>Setting the Active Selection with the Web API<a class="headerlink" href="#setting-the-active-selection-with-the-web-api" title="Permalink to this headline">¶</a></h3>
<p>To set the run-time map selection using a query, perform the following steps:</p>
<blockquote>
<div><ul class="simple">
<li>Create a selection as described in <cite>selecting-with-the-web-api</cite>. This creates a feature reader containing the selected features.</li>
<li>Create an <code class="docutils literal"><span class="pre">MgSelection</span></code> object to hold the features in the feature reader.</li>
<li>Send the selection to the Viewer, along with a call to the Viewer API function <code class="docutils literal"><span class="pre">SetSelectionXML()</span></code>.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example-setting-the-active-selection">
<h3>Example: Setting the Active Selection<a class="headerlink" href="#example-setting-the-active-selection" title="Permalink to this headline">¶</a></h3>
<p>The following example combines the pieces needed to create a selection using
the Web API and pass it back to the Viewer where it becomes the active
selection for the map. It is an extension of the example shown <a class="reference internal" href="#example-selection"><span class="std std-ref">Example: Selection</span></a>.</p>
<p>The PHP code in this example creates the selection XML. Following that is a
JavaScript function that calls the <code class="docutils literal"><span class="pre">SetSelectionXML()</span></code> function with the
selection. This function is executed when the page loads.</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">body</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;AppFrame&quot;</span> <span class="nx">onLoad</span><span class="o">=</span><span class="s2">&quot;OnPageLoad()&quot;</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;AppHeading&quot;</span><span class="o">&gt;</span><span class="nx">Select</span> <span class="nx">features</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>

    <span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">include</span> <span class="s1">&#39;../common/common.php&#39;</span><span class="p">;</span>

    <span class="nv">$args</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">)</span><span class="o">?</span> <span class="nv">$_POST</span> <span class="o">:</span> <span class="nv">$_GET</span><span class="p">;</span>
    <span class="nv">$sessionId</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="s1">&#39;SESSION&#39;</span><span class="p">];</span>
    <span class="nv">$mapName</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="s1">&#39;MAPNAME&#39;</span><span class="p">];</span>

    <span class="k">try</span>
    <span class="p">{</span>

        <span class="c1">// Initialize the Web Extensions and connect to the Server</span>
        <span class="c1">// using the Web Extensions session identifier</span>

        <span class="nx">MgInitializeWebTier</span> <span class="p">(</span><span class="nv">$webconfigFilePath</span><span class="p">);</span>

        <span class="nv">$userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgUserInformation</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">);</span>
        <span class="nv">$siteConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgSiteConnection</span><span class="p">();</span>
        <span class="nv">$siteConnection</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">(</span><span class="nv">$userInfo</span><span class="p">);</span>

        <span class="nv">$map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgMap</span><span class="p">(</span><span class="nv">$siteConnection</span><span class="p">);</span>
        <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">(</span><span class="nv">$mapName</span><span class="p">);</span>

        <span class="c1">// Get the geometry for the boundaries of District 6</span>

        <span class="nv">$districtQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
        <span class="nv">$districtQuery</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s2">&quot;ID = &#39;6&#39;&quot;</span><span class="p">);</span>

        <span class="nv">$layer</span> <span class="o">=</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">GetLayers</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">GetItem</span><span class="p">(</span><span class="s1">&#39;Districts&#39;</span><span class="p">);</span>
        <span class="nv">$featureReader</span> <span class="o">=</span> <span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">SelectFeatures</span><span class="p">(</span><span class="nv">$districtQuery</span><span class="p">);</span>
        <span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">ReadNext</span><span class="p">();</span>
        <span class="nv">$districtGeometryData</span> <span class="o">=</span> <span class="nv">$featureReader</span><span class="o">-&gt;</span><span class="na">GetGeometry</span><span class="p">(</span><span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">GetFeatureGeometryName</span><span class="p">());</span>

        <span class="c1">// Convert the AGF binary data to MgGeometry.</span>

        <span class="nv">$agfReaderWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgAgfReaderWriter</span><span class="p">();</span>
        <span class="nv">$districtGeometry</span> <span class="o">=</span> <span class="nv">$agfReaderWriter</span><span class="o">-&gt;</span><span class="na">Read</span><span class="p">(</span><span class="nv">$districtGeometryData</span><span class="p">);</span>
        <span class="c1">// Create a filter to select the desired features. Combine</span>
        <span class="c1">// a basic filter and a spatial filter.</span>
        <span class="nv">$queryOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgFeatureQueryOptions</span><span class="p">();</span>
        <span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetFilter</span><span class="p">(</span><span class="s2">&quot;RNAME LIKE &#39;SCHMITT%&#39;&quot;</span><span class="p">);</span>
        <span class="nv">$queryOptions</span><span class="o">-&gt;</span><span class="na">SetSpatialFilter</span><span class="p">(</span><span class="s1">&#39;SHPGEOM&#39;</span><span class="p">,</span> <span class="nv">$districtGeometry</span><span class="p">,</span> <span class="nx">MgFeatureSpatialOperations</span><span class="o">::</span><span class="na">Inside</span><span class="p">);</span>
        <span class="c1">// Get the features from the feature source,</span>
        <span class="c1">// turn it into a selection, then save the selection as XML.</span>
        <span class="nv">$layer</span> <span class="o">=</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">GetLayers</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">GetItem</span><span class="p">(</span><span class="s1">&#39;Parcels&#39;</span><span class="p">);</span>
        <span class="nv">$featureReader</span> <span class="o">=</span> <span class="nv">$layer</span><span class="o">-&gt;</span><span class="na">SelectFeatures</span><span class="p">(</span><span class="nv">$queryOptions</span><span class="p">);</span>
        <span class="nv">$layer</span> <span class="o">=</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">GetLayers</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">GetItem</span><span class="p">(</span><span class="s1">&#39;Parcels&#39;</span><span class="p">);</span>
        <span class="nv">$selection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgSelection</span><span class="p">(</span><span class="nv">$map</span><span class="p">);</span>
        <span class="nv">$selection</span><span class="o">-&gt;</span><span class="na">AddFeatures</span><span class="p">(</span><span class="nv">$layer</span><span class="p">,</span> <span class="nv">$featureReader</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nv">$selectionXml</span> <span class="o">=</span> <span class="nv">$selection</span><span class="o">-&gt;</span><span class="na">ToXml</span><span class="p">();</span>
        <span class="k">echo</span> <span class="s1">&#39;Selecting parcels owned by Schmitt in District&amp;nbsp;1&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">MgException</span> <span class="nv">$e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">GetExceptionMessage</span><span class="p">();</span>
        <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">GetDetails</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;script language=&quot;javascript&quot;&gt;</span>
<span class="x">    // Emit this function and assocate it with the onLoad event</span>
<span class="x">    // for the page so that it gets executed when this page</span>
<span class="x">    // loads in the browser. The function calls the</span>
<span class="x">    // SetSelectionXML method on the Viewer Frame, which updates</span>
<span class="x">    // the current selection on the viewer and the server.</span>
<span class="x">    function OnPageLoad()</span>
<span class="x">    {</span>
<span class="x">        selectionXml = &#39;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$selectionXml</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&#39;;</span>
<span class="x">        parent.parent.SetSelectionXML(selectionXml);</span>
<span class="x">    }</span>
<span class="x">&lt;/script&gt;</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre>  &lt;!-- This code fragment assumes you have imported the OSGeo.MapGuide namespace --&gt;
  &lt;body class=&quot;AppFrame&quot; onLoad=&quot;OnPageLoad()&quot;&gt;

      &lt;h1 class=&quot;AppHeading&quot;&gt;Select features&lt;/h1&gt;

  &lt;%

  sessionId = Request.Params[&quot;SESSION&quot;];
  mapName = Request.Params[&quot;MAPNAME&quot;];

  try
  {

    // Initialize the Web Extensions and connect to the Server using
    // the Web Extensions session identifier stored in PHP session state.

    MapGuideApi.MgInitializeWebTier (Constants.WebConfigPath);

    MgUserInformation userInfo = new MgUserInformation(sessionId);
    MgSiteConnection siteConnection = new MgSiteConnection();
    siteConnection.Open(userInfo);

    MgMap map = new MgMap(siteConnection);
    map.Open(mapName);

    // Get the geometry for the boundaries of District 6

    MgFeatureQueryOptions districtQuery = new MgFeatureQueryOptions();
    districtQuery.SetFilter(&quot;ID = &#39;6&#39;&quot;);

    MgLayerBase layer = map.GetLayers().GetItem(&quot;Districts&quot;);
    MgFeatureReader featureReader = layer.SelectFeatures(districtQuery);
    MgByteReader districtGeometryData = null;
    try {
      featureReader.ReadNext();
      districtGeometryData = featureReader.GetGeometry(layer.GetFeatureGeometryName());
    } finally { //Ensures the reader is closed regardless
      featureReader.Close();
    }

    // Convert the AGF binary data to MgGeometry.

    MgAgfReaderWriter agfReaderWriter = new MgAgfReaderWriter();
    MgGeometry districtGeometry = agfReaderWriter.Read(districtGeometryData);

    // Create a filter to select the desired features. Combine
    // a basic filter and a spatial filter.

    MgFeatureQueryOptions queryOptions = new MgFeatureQueryOptions();
    queryOptions.SetFilter(&quot;RNAME LIKE &#39;SCHMITT%&#39;&quot;);
    queryOptions.SetSpatialFilter(&quot;SHPGEOM&quot;, districtGeometry, MgFeatureSpatialOperations.Inside);

    // Get the features from the feature source,
    // turn it into a selection, then save the selection as XML.

    layer = map.GetLayers().GetItem(&quot;Parcels&quot;);
    featureReader = layer.SelectFeatures(queryOptions);

    MgSelection selection = new MgSelection(map);
    selection.AddFeatures(layer, featureReader, 0);
    selectionXml = selection.ToXml();

    Response.Write(&quot;Selecting parcels owned by Schmitt in District&amp;nbsp;1&quot;);
  }
  catch (MgException e)
  {
    Response.Write(e.GetExceptionMessage());
    Response.Write(e.GetDetails());
  }
  %&gt;

&lt;/body&gt;

&lt;script language=&quot;javascript&quot;&gt;

  &lt;!-- Emit this function and assocate it with the onLoad event for the -.
  &lt;!-- page so that it gets executed when this page loads in the        -.
  &lt;!-- browser. The function calls the SetSelectionXML method on the    -.
  &lt;!-- Viewer Frame, which updates the current selection on the viewer  -.
  &lt;!-- and the server.                                                  -.

  function OnPageLoad()
  {
    selectionXml = &#39;&lt;%= selectionXml %&gt;&#39;;
    parent.parent.SetSelectionXML(selectionXml);
  }

&lt;/script&gt;
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//This code fragment assumes you have imported the org.osgeo.mapguide namespace</span>

<span class="c1">//Code sample currently not available</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modifying_maps_and_layers.html" title="Modifying Maps and Layers"
             >next</a> |</li>
        <li class="right" >
          <a href="interacting_with_layers.html" title="Interacting With Layers"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MapGuide Developer&#39;s Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2011, Open Source Geospatial Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>