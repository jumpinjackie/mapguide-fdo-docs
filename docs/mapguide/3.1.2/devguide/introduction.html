<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction &mdash; MapGuide Developer&#39;s Guide</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="MapGuide Developer&#39;s Guide" href="index.html" />
    <link rel="next" title="The MapGuide AJAX Viewer" href="mapguide_ajax_viewer.html" />
    <link rel="prev" title="Revision History" href="revision_history.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mapguide_ajax_viewer.html" title="The MapGuide AJAX Viewer"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="revision_history.html" title="Revision History"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MapGuide Developer&#39;s Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/mgos.gif" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#what-this-guide-covers">What This Guide Covers</a></li>
<li><a class="reference internal" href="#essential-concepts">Essential Concepts</a></li>
<li><a class="reference internal" href="#preparing-to-run-the-examples">Preparing to Run the Examples</a></li>
<li><a class="reference internal" href="#application-development">Application Development</a></li>
<li><a class="reference internal" href="#resources-and-repositories">Resources and Repositories</a><ul>
<li><a class="reference internal" href="#library-and-session">Library and Session</a></li>
<li><a class="reference internal" href="#maps">Maps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hello-map-displaying-a-web-layout">Hello, Map - Displaying a Web Layout</a></li>
<li><a class="reference internal" href="#hello-map-2-adding-a-custom-command">Hello, Map 2 - Adding a Custom Command</a><ul>
<li><a class="reference internal" href="#web-layouts-and-mapguide-server-pages">Web Layouts and MapGuide Server Pages</a></li>
<li><a class="reference internal" href="#mapguide-page-flow">MapGuide Page Flow</a></li>
<li><a class="reference internal" href="#example-code">Example Code</a></li>
<li><a class="reference internal" href="#how-this-page-works">How This Page Works</a></li>
</ul>
</li>
<li><a class="reference internal" href="#understanding-services">Understanding Services</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="revision_history.html"
                        title="previous chapter">Revision History</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="mapguide_ajax_viewer.html"
                        title="next chapter">The MapGuide AJAX Viewer</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/introduction.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="introduction">
<span id="index-0"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-this-guide-covers">
<h2>What This Guide Covers<a class="headerlink" href="#what-this-guide-covers" title="Permalink to this headline">¶</a></h2>
<p>This guide describes how to use the MapGuide Open Source Web API and Viewer
API.</p>
<p>It assumes you have read the MapGuide Getting Started guide and are familiar
with using Autodesk MapGuide or MapGuide Maestro. Most examples also assume that you have installed the
sample data and sample applications supplied with MapGuide.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MapGuide Maestro is a free and open source authoring tool for MapGuide. You can download the latest release <a class="reference external" href="trac.osgeo.org/mapguide/wiki/maestro">here</a></p>
</div>
<p>This guide provides a high-level overview of the APIs. More detailed information
is provided in the on-line MapGuide Web API Reference and MapGuide Viewer API
Reference.</p>
</div>
<div class="section" id="essential-concepts">
<span id="index-1"></span><h2>Essential Concepts<a class="headerlink" href="#essential-concepts" title="Permalink to this headline">¶</a></h2>
<p>Refer to the MapGuide Getting Started guide for details about the MapGuide
architecture and components. It is important to understand the relationship
between a MapGuide Viewer, a MapGuide Web application, and the MapGuide
site. It is also important to understand resources and repositories.</p>
<p>Web applications reside on the Web Server. They are normally executed by
requests from a MapGuide Viewer. They can in turn communicate with the
MapGuide site and send data back to the Viewer.</p>
<p>When you define a web layout, using Autodesk MapGuide or some other
method, you also define toolbar and menu commands. These can be standard
pre-defined Viewer commands like pan, zoom, and refresh, or they can be
custom commands. Custom commands are a way of extending MapGuide to interact with your mapping data.</p>
<p>The custom commands are HTML pages, generated on the server using PHP, ASP.NET, or Java (JSP). These languages
can use the Web API to retrieve, manipulate, and update mapping data.</p>
<p>Many custom commands run in the task area, a section of the Viewer that is
designed for user input/output. For more details about the task area and how
it integrates with the rest of the Viewer, see The MapGuide Viewer on page
15.</p>
</div>
<div class="section" id="preparing-to-run-the-examples">
<h2>Preparing to Run the Examples<a class="headerlink" href="#preparing-to-run-the-examples" title="Permalink to this headline">¶</a></h2>
<p>MapGuide includes a set of sample applications. Some of them correspond
directly to chapters in this Developer&#8217;s Guide. These samples are designed to
show one or two key concepts at a time.</p>
<p>Other sample applications are more full-featured. These are designed to show
some of the capabilities of MapGuide. They are not discussed in detail in this
guide, but they do build upon the basic concepts.</p>
<p>The sample applications are available on the <a class="reference external" href="http://mapguide.osgeo.org/downloads.html">MapGuide Open Source Download Page</a>. See the manual
Installing Sample Data and Viewer Sample Application also available on the download site for details.</p>
<p>Complete examples are available from <a class="reference external" href="http://mapguide.osgeo.org/downloads.html">MapGuide Open Source Download Page</a>.
There are two required components: the source code and a package file for
creating the web layouts. The Sheboygan sample data must also be installed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The Web API supports .NET, Java, and PHP. Each code sample illustrated in this developer&#8217;s guide will show the same code in all 3 lanugages</p>
<p class="last">To run the examples on a Linux installation, change any Windows-specific
file paths to corresponding Linux paths.</p>
</div>
<p>This guide includes many code snippets. In most cases, the snippets are
incomplete, lacking initialization and error-checking. For more complete
versions, refer to the sample applications.</p>
</div>
<div class="section" id="application-development">
<span id="index-2"></span><h2>Application Development<a class="headerlink" href="#application-development" title="Permalink to this headline">¶</a></h2>
<p>Hints for debugging, etc.</p>
<p>Making script frame visible to catch errors there</p>
<p>Use Firefox because of DOM Inspector, Error console, Venckman,</p>
<p>Reading Apache log for PHP errors. Is there an equivalent for IIS? Other sources
of log information?</p>
</div>
<div class="section" id="resources-and-repositories">
<span id="index-4"></span><h2>Resources and Repositories<a class="headerlink" href="#resources-and-repositories" title="Permalink to this headline">¶</a></h2>
<p>A MapGuide repository is a database that stores and manages the data for the
site. The repository stores all data except data that is stored in external
databases. Data stored in a repository is a resource.</p>
<p>Types of data stored in the repository:</p>
<blockquote>
<div><ul class="simple">
<li>Feature Sources</li>
<li>Drawing Sources</li>
<li>Layer definitions</li>
<li>Map definitions</li>
<li>Web layouts</li>
<li>Flexible Web Layouts (aka. Application Definitions)</li>
<li>Symbol Libraries</li>
<li>Symbol Definitions</li>
<li>Load Procedures</li>
<li>Print Layouts</li>
</ul>
</div></blockquote>
<div class="section" id="library-and-session">
<span id="index-6"></span><h3>Library and Session<a class="headerlink" href="#library-and-session" title="Permalink to this headline">¶</a></h3>
<p>Persistent data that is available to all users is stored in the Library repository.</p>
<p>In addition, each session has its own repository, which stores the run-time
map state. It can also be used to store other data, like temporary layers that
apply only to an individual session. For example, a temporary layer might be
used to overlay map symbols indicating places of interest.
Data in a session repository is destroyed when the session ends.</p>
<p>A resource identifier for a resource in the Library will always begin with
<code class="docutils literal"><span class="pre">Library://</span></code>. For example:</p>
<p><code class="docutils literal"><span class="pre">Library://Samples/Layouts/SamplesPhp.WebLayout</span></code></p>
<p>A resource identifier for a session resource will always begin with <code class="docutils literal"><span class="pre">Session:</span></code>,
followed by the session id. For example:</p>
<p><code class="docutils literal"><span class="pre">Session:70ea89fe-0000-1000-8000-005056c00008_en//layer.LayerDefinition</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unless you have logged in with the Administrator login, security restrictions are generally imposed when reading/writing to the Library repository.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you get &#8220;resource not found&#8221; errors on a session resource id when attempting to read/write resources to the session repository, chances
are the MapGuide Server has determined the session has been idle for too long and has already destroyed the repository. To ensure the session
remains alive, you can tick the &#8220;Keep Connection Alive&#8221; Web Layout option in Autodesk MapGuide Studio. A similar option exists in MapGuide Maestro&#8217;s
Web Layout editor.</p>
</div>
</div>
<div class="section" id="maps">
<span id="index-7"></span><h3>Maps<a class="headerlink" href="#maps" title="Permalink to this headline">¶</a></h3>
<p>A map (<code class="docutils literal"><span class="pre">MgMap</span></code> object) is created from a map definition resource. The map definition contains
basic information about the map, including things like:</p>
<blockquote>
<div><ul class="simple">
<li>the coordinate system used in the map</li>
<li>the initial map extents</li>
<li>references to the layer definitions for layers in the map</li>
</ul>
</div></blockquote>
<p>When the <code class="docutils literal"><span class="pre">MgMap</span></code> object is created, it is initialized with data from the map
definition. As a user interacts with the map, the <code class="docutils literal"><span class="pre">MgMap</span></code> may change, but the
map definition does not.</p>
<p>The map is saved in the session repository so it is available to all pages in the
same session. You cannot save a map in the library repository.
Map creation is handled by the Viewers. When a Viewer first loads, it creates
a map in the session repository.</p>
<p>The map name is taken from the map definition name. For example, if a web layout references a map definition
named <code class="docutils literal"><span class="pre">Sheboygan.MapDefinition</span></code>, then the Viewer will create a map named <code class="docutils literal"><span class="pre">Sheboygan.Map</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">Sheboygan.Map</span></code> represents the internal state of the runtime instance of <code class="docutils literal"><span class="pre">Sheboygan.MapDefinition</span></code> and is
read and written when you call <code class="docutils literal"><span class="pre">Open()</span></code> and <code class="docutils literal"><span class="pre">Save()</span></code> respectively on the <code class="docutils literal"><span class="pre">MgMap</span></code> object. Users are never allowed
direct access to this resource.</p>
</div>
<p>If your application does not use a Viewer, you can create the map and store
it in the repository yourself. To do this, your page must</p>
<blockquote>
<div><ul class="simple">
<li>Create an <code class="docutils literal"><span class="pre">MgMap</span></code> object.</li>
<li>Initialize the <code class="docutils literal"><span class="pre">MgMap</span></code> object from a map definition.</li>
<li>Assign a name to the <code class="docutils literal"><span class="pre">MgMap</span></code> object.</li>
<li>Save the map in the session repository.</li>
</ul>
</div></blockquote>
<p>For example, the following section of code creates an <code class="docutils literal"><span class="pre">MgMap</span></code> named <code class="docutils literal"><span class="pre">Sheboygan.Map</span></code>, based on <code class="docutils literal"><span class="pre">Sheboygan.MapDefinition</span></code>.</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$siteConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgSiteConnection</span><span class="p">();</span>
<span class="nv">$userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgUserInformation</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">);</span>
<span class="nv">$siteConnection</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">();</span>
<span class="nv">$resourceService</span> <span class="o">=</span> <span class="nv">$siteConnection</span><span class="o">-&gt;</span><span class="na">CreateService</span><span class="p">(</span><span class="nx">MgServiceType</span><span class="o">::</span><span class="na">ResourceService</span><span class="p">);</span>

<span class="nv">$mapDefId</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgResourceIdentifier</span><span class="p">(</span><span class="s2">&quot;Library://Samples/Sheboygan/Maps/Sheboygan.MapDefinition&quot;</span><span class="p">);</span>
<span class="nv">$map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgMap</span><span class="p">(</span><span class="nv">$siteConnection</span><span class="p">);</span>
<span class="nv">$mapName</span> <span class="o">=</span> <span class="nv">$mapDefId</span><span class="o">-&gt;</span><span class="na">GetName</span><span class="p">();</span>
<span class="nv">$map</span><span class="o">-&gt;</span><span class="na">Create</span><span class="p">(</span><span class="nv">$mapDefId</span><span class="p">,</span> <span class="nv">$mapName</span><span class="p">);</span>
<span class="nv">$mapId</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgResourceIdentifier</span><span class="p">(</span><span class="s2">&quot;Session:</span><span class="si">$sessionId</span><span class="s2">//</span><span class="si">$mapName</span><span class="s2">.&quot;</span> <span class="o">.</span> <span class="nx">MgResourceType</span><span class="o">::</span><span class="na">Map</span><span class="p">);</span>
<span class="nv">$map</span><span class="o">-&gt;</span><span class="na">Save</span><span class="p">(</span><span class="nv">$resourceService</span><span class="p">,</span> <span class="nv">$mapId</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//Note: This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>
<span class="n">MgSiteConnection</span> <span class="n">siteConnection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgSiteConnection</span><span class="p">();</span>
<span class="n">MgUserInformation</span> <span class="n">userInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgUserInformation</span><span class="p">(</span><span class="n">sessionId</span><span class="p">);</span>
<span class="n">siteConnection</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">userInfo</span><span class="p">);</span>
<span class="n">MgResourceService</span> <span class="n">resourceService</span> <span class="p">=</span> <span class="p">(</span><span class="n">MgResourceService</span><span class="p">)</span><span class="n">siteConnection</span><span class="p">.</span><span class="n">CreateService</span><span class="p">(</span><span class="n">MgServiceType</span><span class="p">::</span><span class="n">ResourceService</span><span class="p">);</span>

<span class="n">MgResourceIdentifier</span> <span class="n">mapDefId</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgResourceIdentifier</span><span class="p">(</span><span class="s">&quot;Library://Samples/Sheboygan/Maps/Sheboygan.MapDefinition&quot;</span><span class="p">);</span>
<span class="n">MgMap</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgMap</span><span class="p">(</span><span class="n">siteConnection</span><span class="p">);</span>
<span class="n">String</span> <span class="n">mapName</span> <span class="p">=</span> <span class="n">mapDefId</span><span class="p">.</span><span class="n">GetName</span><span class="p">();</span>
<span class="n">map</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">mapDefId</span><span class="p">,</span> <span class="n">mapName</span><span class="p">);</span>
<span class="n">MgResourceIdentifier</span> <span class="n">mapId</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgResourceIdentifier</span><span class="p">(</span><span class="s">&quot;Session:&quot;</span> <span class="p">+</span> <span class="n">sessionId</span> <span class="p">+</span> <span class="s">&quot;//&quot;</span> <span class="p">+</span> <span class="n">mapName</span> <span class="p">+</span> <span class="s">&quot;.&quot;</span> <span class="p">+</span> <span class="n">MgResourceType</span><span class="p">.</span><span class="n">Map</span><span class="p">);</span>
<span class="n">map</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">resourceService</span><span class="p">,</span> <span class="n">mapId</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//Note: This code fragment assumes you have imported the org.osgeo.mapguide package</span>
<span class="n">MgSiteConnection</span> <span class="n">siteConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgSiteConnection</span><span class="o">();</span>
<span class="n">MgUserInformation</span> <span class="n">userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgUserInformation</span><span class="o">(</span><span class="n">sessionId</span><span class="o">);</span>
<span class="n">siteConnection</span><span class="o">.</span><span class="na">Open</span><span class="o">(</span><span class="n">userInfo</span><span class="o">);</span>
<span class="n">MgResourceService</span> <span class="n">resourceService</span> <span class="o">=</span> <span class="o">(</span><span class="n">MgResourceService</span><span class="o">)</span><span class="n">siteConnection</span><span class="o">.</span><span class="na">CreateService</span><span class="o">(</span><span class="n">MgServiceType</span><span class="o">::</span><span class="n">ResourceService</span><span class="o">);</span>

<span class="n">MgResourceIdentifier</span> <span class="n">mapDefId</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgResourceIdentifier</span><span class="o">(</span><span class="s">&quot;Library://Samples/Sheboygan/Maps/Sheboygan.MapDefinition&quot;</span><span class="o">);</span>
<span class="n">MgMap</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgMap</span><span class="o">(</span><span class="n">siteConnection</span><span class="o">);</span>
<span class="n">String</span> <span class="n">mapName</span> <span class="o">=</span> <span class="n">mapDefId</span><span class="o">.</span><span class="na">GetName</span><span class="o">();</span>
<span class="n">map</span><span class="o">.</span><span class="na">Create</span><span class="o">(</span><span class="n">mapDefId</span><span class="o">,</span> <span class="n">mapName</span><span class="o">);</span>
<span class="n">MgResourceIdentifier</span> <span class="n">mapId</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgResourceIdentifier</span><span class="o">(</span><span class="s">&quot;Session:&quot;</span> <span class="o">+</span> <span class="n">sessionId</span> <span class="o">+</span> <span class="s">&quot;//&quot;</span> <span class="o">+</span> <span class="n">mapName</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">MgResourceType</span><span class="o">.</span><span class="na">Map</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">Save</span><span class="o">(</span><span class="n">resourceService</span><span class="o">,</span> <span class="n">mapId</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hello-map-displaying-a-web-layout">
<span id="index-9"></span><h2>Hello, Map - Displaying a Web Layout<a class="headerlink" href="#hello-map-displaying-a-web-layout" title="Permalink to this headline">¶</a></h2>
<p>A web layout describes how the map looks when it is displayed in a web
browser. Using Studio, Maestro or some other method to edit the web layout resource,
you can create and customize the layout, changing how it looks in a browser
and what features are enabled.</p>
<p>The AJAX Viewer does not require installing any additional software. It runs
using most browsers, including Internet Explorer, Mozilla Firefox, Google Chrome and Safari.</p>
<p>The simplest way to display a web layout is to pass its resource identifier as a
GET parameter to the Viewer URL. For example, the following will display a
web layout using the AJAX Viewer running on localhost:</p>
<p><code class="docutils literal"><span class="pre">http://localhost/mapguide/mapviewerajax/?WEBLAYOUT=Library%3a%2f%2fSamples%2fLayouts%2fSample.WebLayout</span></code></p>
<p><strong>Authentication</strong></p>
<p>All MapGuide sites require authentication with user id and password. If
authentication succeeds, MapGuide creates a session, identified by a unique
session id. This keeps the state consistent between the viewer and the server
across multiple HTTP requests. Subsequent access to the site requires the
session id instead of the user id. By default, the Viewer handles authentication
itself, and it prompts for user id and password when it first loads. There are
situations, though, where it is better to authenticate before loading the Viewer
page.</p>
<p>One common example is a site offering read-only access to visitors. For this
situation, the default MapGuide installation includes a user <code class="docutils literal"><span class="pre">Anonymous</span></code>
with an empty password.</p>
<p>To perform authentication before the Viewer loads, embed the Viewer in
another page using a <code class="docutils literal"><span class="pre">&lt;frame&gt;</span></code> or <code class="docutils literal"><span class="pre">&lt;iframe&gt;</span></code> element. The outer page can do
any necessary authentication, create a session, then pass the web layout and
session id to the Viewer frame.</p>
<p>The following example displays a web layout using the AJAX Viewer. It
performs some basic initialization and creates a session, then displays a Viewer
page using the session identifier and the web layout.</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$installDir</span> <span class="o">=</span>
   <span class="s1">&#39;C:\\Program Files\\OSGeo\\MapGuide\\&#39;</span><span class="p">;</span>
<span class="nv">$extensionsDir</span> <span class="o">=</span> <span class="nv">$installDir</span> <span class="o">.</span> <span class="s1">&#39;Web\\www\\&#39;</span><span class="p">;</span>
<span class="nv">$viewerDir</span> <span class="o">=</span> <span class="nv">$installDir</span> <span class="o">.</span> <span class="s1">&#39;mapviewerphp\\&#39;</span><span class="p">;</span>

<span class="k">include</span> <span class="nv">$viewerDir</span> <span class="o">.</span> <span class="s1">&#39;constants.php&#39;</span><span class="p">;</span>

<span class="nx">MgInitializeWebTier</span><span class="p">(</span><span class="nv">$extensionsDir</span> <span class="o">.</span> <span class="s1">&#39;webconfig.ini&#39;</span><span class="p">);</span>

<span class="nv">$site</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgSite</span><span class="p">();</span>
<span class="nv">$site</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">(</span><span class="k">new</span> <span class="nx">MgUserInformation</span><span class="p">(</span><span class="s2">&quot;Anonymous&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">));</span>

<span class="nv">$sessionId</span> <span class="o">=</span> <span class="nv">$site</span><span class="o">-&gt;</span><span class="na">CreateSession</span><span class="p">();</span>
<span class="nv">$webLayout</span> <span class="o">=</span> <span class="s2">&quot;Library://Samples/Layouts/SamplesPhp.WebLayout&quot;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>

<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">&lt;title&gt;Simple Sample Application&lt;/title&gt;</span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body marginheight=&quot;0&quot; marginwidth=&quot;0&quot;&gt;</span>
<span class="x">&lt;iframe id=&quot;viewerFrame&quot; width=&quot;100%&quot; height=&quot;100%&quot; frameborder=0</span>
<span class="x">scrolling=&quot;no&quot;</span>
<span class="x">src=&quot;/mapguide/mapviewerajax/?SESSION=</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$sessionId</span> <span class="cp">?&gt;</span><span class="x">&amp;</span>
<span class="x">WEBLAYOUT=</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$webLayout</span> <span class="cp">?&gt;</span><span class="x">&quot;&gt;&lt;/iframe&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="n">Code</span> <span class="n">sample</span> <span class="n">coming</span> <span class="n">soon</span><span class="p">!</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">Code</span> <span class="n">sample</span> <span class="n">coming</span> <span class="n">soon</span><span class="o">!</span>
</pre></div>
</div>
</div>
<div class="section" id="hello-map-2-adding-a-custom-command">
<span id="index-10"></span><h2>Hello, Map 2 - Adding a Custom Command<a class="headerlink" href="#hello-map-2-adding-a-custom-command" title="Permalink to this headline">¶</a></h2>
<p>Web layouts can include custom commands added to the toolbar, context
menu, task list, or task pane area of the Viewer. These custom commands
make up the MapGuide application.</p>
<p>This next sample MapGuide page displays some basic information about a
map. It does not do any complicated processing. Its purpose is to illustrate
the steps required to create a MapGuide page and have it connect to a Viewer
on one side and the MapGuide site on the other.</p>
<div class="section" id="web-layouts-and-mapguide-server-pages">
<span id="index-11"></span><h3>Web Layouts and MapGuide Server Pages<a class="headerlink" href="#web-layouts-and-mapguide-server-pages" title="Permalink to this headline">¶</a></h3>
<p>A <em>MapGuide Server Page</em> is any PHP, ASP.NET, or JSP page that makes use of the
MapGuide Web API. These pages are typically invoked by the MapGuide
Viewer or browser and when processed result in HTML pages that are loaded
into a MapGuide Viewer or browser frame. This is the form that will be used
for most examples in this guide. It is possible, however, to create pages that
do not return HTML or interact with the Viewer at all. These can be used for
creating web services as a back-end to another mapping client or for batch
processing of your data.</p>
<p>Creating a MapGuide page requires initial setup, to make the proper
connections between the Viewer, the page, and the MapGuide site. Refer
to the <em>MapGuide Studio Help</em> for details.</p>
<p>One part of the initial setup is creating a web layout, which defines the
appearance and available functions for the Viewer. When you define a web
layout, you assign it a resource name that describes its location in the
repository. The full resource name looks something like this:</p>
<p><code class="docutils literal"><span class="pre">Library://Samples/Layouts/SamplesPhp.WebLayout</span></code></p>
<p>When you open the web layout using a browser with the AJAX Viewer the resource name
is passed as part of the Viewer URL. Special characters in the resource name are URL-encoded,
so the full URL would look something like this, (with line breaks removed):</p>
<p><code class="docutils literal"><span class="pre">http://localhost/mapguide/mapviewerajax/?WEBLAYOUT=Library%3a%2f%2fSamples%2fSheboygan%2fLayouts%2fSheboyganPhp.WebLayout</span></code></p>
<p>Part of the web layout defines commands and the toolbars and menus that
contain the commands. These commands can be built-in commands, or they
can be URLs to custom pages. The web layout also includes a URL to a home
task that displays in the task pane. The home task can open other pages.</p>
<p>To create a new page and make it available as a command from the task list,
do the following:</p>
<blockquote>
<div><ul class="simple">
<li>Edit the web layout using Studio or Maestro</li>
<li>Add a command to the web layout.</li>
<li>Set the command type to Invoke URL.</li>
<li>Set the URL of the command to the URL of your page</li>
<li>Add the command to the Task Bar Menu.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Custom pages are loaded by the Viewer page, so a relative URL for a custom
page must start at the Viewer directory, then go up one level to reach the <code class="docutils literal"><span class="pre">mapguide</span></code>
directory. For example, a custom page located at <code class="docutils literal"><span class="pre">www/mapguide/samplesphp/index.php</span></code>
would use the following relative URL in the web layout</p>
<p class="last"><code class="docutils literal"><span class="pre">../samplesphp/index.php</span></code></p>
</div>
<p>It is also possible to add custom commands to the toolbar and the context
menu using the same technique.</p>
<p>For most of the examples in this guide, however, the pages will be links from
a home page loaded in the task pane frame.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Installing the package that comes with the Developer&#8217;s Guide samples
creates a web layout automatically. The home task page of this layout contains
links to examples that correspond to chapters in the Developer&#8217;s Guide.</p>
</div>
</div>
<div class="section" id="mapguide-page-flow">
<h3>MapGuide Page Flow<a class="headerlink" href="#mapguide-page-flow" title="Permalink to this headline">¶</a></h3>
<p>Most MapGuide pages follow a similar processing flow. First, they create a
connection with the site server using an existing session id. Then they open
connections to any needed site services. The exact services required depend
on the page function. For example, a page that deals with map feature data
requires a feature service connection.</p>
<p>Once the site connection and any other service connections are open, the
page can use MapGuide Web API calls to retrieve and process data. Output
goes to the task pane or back to the Viewer. See <a class="reference internal" href="mapguide_ajax_viewer.html#mapguide-ajax-viewer"><span class="std std-ref">The MapGuide AJAX Viewer</span></a> for details about sending data to the Viewer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MapGuide pages written in PHP require one additional step because PHP
does not support enumerations compiled into extensions. To deal with this
limitation, PHP Web Extension pages must include constants.php, which is in
the mapviewerphp folder. This is not required for ASP.NET or JSP pages.</p>
</div>
</div>
<div class="section" id="example-code">
<h3>Example Code<a class="headerlink" href="#example-code" title="Permalink to this headline">¶</a></h3>
<p>The following sample illustrates basic page structure. It is designed to be called
as a task from a Viewer. It connects to a MapGuide server and displays the
map name and spatial reference system for the map currently being displayed
in the Viewer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This sample is very similar to the <code class="docutils literal"><span class="pre">Hello</span> <span class="pre">Map</span></code> sample in the Developer&#8217;s Guide
samples.</p>
</div>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="nx">map</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
        <span class="o">&lt;?</span><span class="nx">php</span>

        <span class="c1">// Define some common locations</span>
        <span class="nv">$installDir</span> <span class="o">=</span><span class="s1">&#39;C:\\Program Files\\OSGeo\\MapGuide\\&#39;</span><span class="p">;</span>
        <span class="nv">$extensionsDir</span> <span class="o">=</span> <span class="nv">$installDir</span> <span class="o">.</span> <span class="s1">&#39;WebServerExtensions\www\\&#39;</span><span class="p">;</span>
        <span class="nv">$viewerDir</span> <span class="o">=</span> <span class="nv">$extensionsDir</span> <span class="o">.</span> <span class="s1">&#39;mapviewerphp\\&#39;</span><span class="p">;</span>

        <span class="c1">// constants.php is required to set some enumerations</span>
        <span class="c1">// for PHP. The same step is not required for .NET</span>
        <span class="c1">// or Java applications.</span>
        <span class="k">include</span> <span class="nv">$viewerDir</span> <span class="o">.</span> <span class="s1">&#39;constants.php&#39;</span><span class="p">;</span>

        <span class="k">try</span>
        <span class="p">{</span>
            <span class="c1">// Get the session information passed from the viewer.</span>
            <span class="nv">$args</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">)</span>
            <span class="o">?</span> <span class="nv">$_POST</span> <span class="o">:</span> <span class="nv">$_GET</span><span class="p">;</span>
            <span class="nv">$mgSessionId</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="s1">&#39;SESSION&#39;</span><span class="p">]</span>
            <span class="nv">$mgMapName</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">[</span><span class="s1">&#39;MAPNAME&#39;</span><span class="p">]</span>

            <span class="c1">// Basic initialization needs to be done every time.</span>
            <span class="nx">MgInitializeWebTier</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$extensionsDir\webconfig</span><span class="s2">.ini&quot;</span><span class="p">);</span>

            <span class="c1">// Get the user information using the session id,</span>
            <span class="c1">// and set up a connection to the site server.</span>
            <span class="nv">$userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgUserInformation</span><span class="p">(</span><span class="nv">$mgSessionId</span><span class="p">);</span>
            <span class="nv">$siteConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgSiteConnection</span><span class="p">();</span>
            <span class="nv">$siteConnection</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">(</span><span class="nv">$userInfo</span><span class="p">);</span>

            <span class="c1">// Display the spatial reference system used for the map.</span>
            <span class="nv">$map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgMap</span><span class="p">(</span><span class="nv">$siteConnection</span><span class="p">);</span>
            <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">(</span><span class="nv">$mgMapName</span><span class="p">);</span>
            <span class="nv">$srs</span> <span class="o">=</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">GetMapSRS</span><span class="p">();</span>
            <span class="k">echo</span> <span class="s1">&#39;Map &lt;strong&gt;&#39;</span> <span class="o">.</span> <span class="nv">$map</span><span class="o">-&gt;</span><span class="na">GetName</span><span class="p">()</span> <span class="o">.</span>
            <span class="s1">&#39;&lt;/strong&gt; uses this reference system: &lt;br /&gt;&#39;</span> <span class="o">.</span> <span class="nv">$srs</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="nx">MgException</span> <span class="nv">$e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;ERROR: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">GetMessage</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
            <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">GetStackTrace</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">        &lt;/p&gt;</span>
<span class="x">    &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="n">Code</span> <span class="n">sample</span> <span class="n">coming</span> <span class="n">soon</span><span class="p">!</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">Code</span> <span class="n">sample</span> <span class="n">coming</span> <span class="n">soon</span><span class="o">!</span>
</pre></div>
</div>
</div>
<div class="section" id="how-this-page-works">
<h3>How This Page Works<a class="headerlink" href="#how-this-page-works" title="Permalink to this headline">¶</a></h3>
<p>This example page performs the following operations:</p>
<p><strong>1. Get session information.</strong></p>
<p>When you first go to the URL containing the web layout, the Viewer
initiates a new session. It prompts for a user id and password, and uses
these to validate with the site server. If the user id and password are valid,
the site server creates a session and sends the session id back to the viewer.
The Viewer passes the session information every time it sends a request
to a MapGuide page. The pages use this information to re-establish a
session.</p>
<p><strong>2. Perform basic initialization.</strong></p>
<p>The webconfig.ini file contains parameters required to connect to the site
server, including the IP address and port numbers to use for
communication. <code class="docutils literal"><span class="pre">MgInitializeWebTier()</span></code> reads the file and gets the
necessary values to find the site server and create a connection.</p>
<p><strong>3. Get user information.</strong></p>
<p>The site server saves the user credentials along with other session
information. These credentials must be supplied when the user first
connects to the site. At that time, the Viewer authenticates the user and
creates a new session using the credentials. Using the session ID, other
pages can get an encrypted copy of the user credentials that can be used
for authentication.</p>
<p><strong>4. Create a site connection.</strong></p>
<p>Any MapGuide pages require a connection to a site server, which manages
the repository and site services.</p>
<p><strong>5. Create a connection to a resource service.</strong></p>
<p>Access to resources is handled by a resource service. In this case, the page
needs a resource service in order to retrieve information about the map
resource. You may need to create connections to other services, depending on the
needs of your application.</p>
<p><strong>6. Retrieve map details.</strong></p>
<p>The map name is also passed by the viewer to the MapGuide page. Use
this name to open a particular map resource with the resource service.
Once the map is open you can get other information. This example
displays the spatial reference system used by the map, but you can also
get more complex information about the layers that make up the map.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The <code class="docutils literal"><span class="pre">MgInitializeWebTier</span></code> function always needs to be called before you create a site connection and
create service connections.</p>
<p class="last">However, this function does not need to be called if you are only using the
Geometry and Coordinate System components of the MapGuide API</p>
</div>
</div>
</div>
<div class="section" id="understanding-services">
<span id="index-12"></span><h2>Understanding Services<a class="headerlink" href="#understanding-services" title="Permalink to this headline">¶</a></h2>
<p>The MapGuide site performs many different functions. These can be all done
by a single server, or you may balance the load across multiple servers. Some
essential functions must execute on the site server, while other functions may
execute on support servers.</p>
<p>A service performs a particular set of related functions. For example, a resource
service manages data in the repository, a feature service provides access to
feature data sources, and a mapping service provides visualization and plotting
functions.</p>
<p>Before a page can use a service, it must open a site connection and create an
instance of the necessary service type. The following example creates a resource
service and a feature service:</p>
<p><strong>PHP</strong></p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgUserInformation</span><span class="p">(</span><span class="nv">$mgSessionId</span><span class="p">);</span>
<span class="nv">$siteConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MgSiteConnection</span><span class="p">();</span>
<span class="nv">$siteConnection</span><span class="o">-&gt;</span><span class="na">Open</span><span class="p">(</span><span class="nv">$userInfo</span><span class="p">);</span>
<span class="nv">$resourceService</span> <span class="o">=</span> <span class="nv">$siteConnection</span><span class="o">-&gt;</span><span class="na">CreateService</span><span class="p">(</span><span class="nx">MgServiceType</span><span class="o">::</span><span class="na">ResourceService</span><span class="p">);</span>
<span class="nv">$featureService</span> <span class="o">=</span> <span class="nv">$siteConnection</span><span class="o">-&gt;</span><span class="na">CreateService</span><span class="p">(</span><span class="nx">MgServiceType</span><span class="o">::</span><span class="na">FeatureService</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>.net (C#)</strong></p>
<div class="highlight-csharp"><div class="highlight"><pre><span class="c1">//Note: This code fragment assumes you have imported the OSGeo.MapGuide namespace</span>

<span class="n">MgUserInformation</span> <span class="n">userInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgUserInformation</span><span class="p">(</span><span class="n">mgSessionId</span><span class="p">);</span>
<span class="n">MgSiteConnection</span> <span class="n">siteConnection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MgSiteConnection</span><span class="p">();</span>
<span class="n">siteConnection</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">userInfo</span><span class="p">);</span>
<span class="n">MgResourceService</span> <span class="n">resourceService</span> <span class="p">=</span> <span class="p">(</span><span class="n">MgResourceService</span><span class="p">)</span><span class="n">siteConnection</span><span class="p">.</span><span class="n">CreateService</span><span class="p">(</span><span class="n">MgServiceType</span><span class="p">.</span><span class="n">ResourceService</span><span class="p">);</span>
<span class="n">MgFeatureService</span> <span class="n">featureService</span> <span class="p">=</span> <span class="p">(</span><span class="n">MgFeatureService</span><span class="p">)</span><span class="n">siteConnection</span><span class="p">.</span><span class="n">CreateService</span><span class="p">(</span><span class="n">MgServiceType</span><span class="p">.</span><span class="n">FeatureService</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Java</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">//Note: This code fragment assumes you have imported the org.osgeo.mapguide package</span>

<span class="n">MgUserInformation</span> <span class="n">userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgUserInformation</span><span class="o">(</span><span class="n">mgSessionId</span><span class="o">);</span>
<span class="n">MgSiteConnection</span> <span class="n">siteConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MgSiteConnection</span><span class="o">();</span>
<span class="n">siteConnection</span><span class="o">.</span><span class="na">Open</span><span class="o">(</span><span class="n">userInfo</span><span class="o">);</span>
<span class="n">MgResourceService</span> <span class="n">resourceService</span> <span class="o">=</span> <span class="o">(</span><span class="n">MgResourceService</span><span class="o">)</span><span class="n">siteConnection</span><span class="o">.</span><span class="na">CreateService</span><span class="o">(</span><span class="n">MgServiceType</span><span class="o">.</span><span class="na">ResourceService</span><span class="o">);</span>
<span class="n">MgFeatureService</span> <span class="n">featureService</span> <span class="o">=</span> <span class="o">(</span><span class="n">MgFeatureService</span><span class="o">)</span><span class="n">siteConnection</span><span class="o">.</span><span class="na">CreateService</span><span class="o">(</span><span class="n">MgServiceType</span><span class="o">.</span><span class="na">FeatureService</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mapguide_ajax_viewer.html" title="The MapGuide AJAX Viewer"
             >next</a> |</li>
        <li class="right" >
          <a href="revision_history.html" title="Revision History"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MapGuide Developer&#39;s Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2011, Open Source Geospatial Foundation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>